<!DOCTYPE html>
<html lang="en" data-alive="on">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>üåç Earth Beacon ¬∑ Take Action Now</title>
<meta name="theme-color" content="#0b0d11">
<meta name="description" content="Earth Beacon ‚Äî a private Care Ledger anyone can use right now. One-tap actions, daily Pulse, no accounts, offline-first, with a printable action card.">
<style>
:root{
  --bg:#0b0d11; --ink:#e9ecf4; --muted:#a8a9b4;
  --card:#101425; --ring:#1c2030; --accent:#86efac; --sky:#b2f5ea; --gold:#ffd479;
  --good:#b6e3b9;
}
*{box-sizing:border-box}
html,body{margin:0;padding:0;background:var(--bg);color:var(--ink);font-family:ui-serif, Georgia, "Times New Roman", serif;line-height:1.6;-webkit-font-smoothing:antialiased}
main{max-width:960px;margin:auto;padding:4.25rem 1rem 6.25rem;position:relative;z-index:2}
h1,h2,h3{letter-spacing:.35px}
h1{font-size:1.75rem;margin:.25rem 0 .6rem;text-align:center}
h2{font-size:1.05rem;color:var(--sky);margin:.1rem 0 .6rem}
h3{font-size:.98rem;margin:.25rem 0 .4rem}
p{margin:.4rem 0 1rem}
a{color:var(--sky);text-decoration:none;border-bottom:1px dotted #7fbde7}
a:hover{border-bottom-color:#c9d6ff}
.small{font-size:.92rem;color:var(--muted)}
.card{background:var(--card);border:1px solid var(--ring);border-radius:12px;padding:1rem;box-shadow:0 0 22px #0006}
.kicker{color:var(--muted);text-align:center;margin-top:-.2rem;margin-bottom:.8rem}
.row{display:flex;gap:.6rem;flex-wrap:wrap;align-items:center}
hr{border:none;border-top:1px solid #121625;margin:1rem 0}

/* Top banner + buttons */
.banner{display:flex;align-items:center;justify-content:center;gap:.5rem;margin:.5rem auto 1rem;width:100%;max-width:760px;background:linear-gradient(180deg,#121624,#0b0d11);border:1px solid #1a2030;border-radius:999px;padding:.55rem .95rem;color:#dfe7ff;text-align:center;box-shadow:0 10px 30px #0007}
.cta{display:inline-block;background:var(--accent);color:#06140b;padding:.55rem .85rem;border-radius:10px;border:1px solid #183b24;text-decoration:none;font-weight:700;letter-spacing:.3px}
.ghost{background:transparent;color:#dfe7ff;border:1px solid #1b2234}

/* Alive layer */
.alive{position:fixed;inset:0;pointer-events:none;z-index:1;overflow:hidden}
.alive .shimmer,.alive .stars{position:absolute;inset:0}
.alive .shimmer{
  background:
    radial-gradient(1100px 1100px at 14% 24%, #86efac12 0%, transparent 60%) no-repeat,
    radial-gradient(880px 880px at 84% 76%, #b2f5ea12 0%, transparent 60%) no-repeat;
  animation:shine 24s linear infinite;mix-blend-mode:screen;filter:blur(.35px)
}
@keyframes shine{0%{background-position:0% 0%,100% 100%}50%{background-position:28% 38%,70% 62%}100%{background-position:0% 0%,100% 100%}}
.alive .stars::before,.alive .stars::after{
  content:"";position:absolute;inset:-20vh -20vw;
  background-image:radial-gradient(#ffffff,transparent 60%),radial-gradient(#b2f5ea,transparent 60%),radial-gradient(#e9ecf4,transparent 60%);
  background-size:2px 2px,1px 1px,1.5px 1.5px;opacity:.35;animation:drift 80s linear infinite
}
.alive .stars::after{opacity:.22;animation-duration:120s}
@keyframes drift{0%{transform:translate3d(0,0,0)}100%{transform:translate3d(6vw,4vh,0)}}
.alive .glyphs{position:absolute;inset:0}
.alive .glyphs span{
  position:absolute;font-size:14px;color:#86efaccc;text-shadow:0 0 10px #86efac33,0 0 22px #b2f5ea26;
  animation:floatY linear infinite,swayX ease-in-out infinite;will-change:transform
}
.g1{left:8%;top:72%;animation-duration:27s,9s}.g2{left:18%;top:18%;animation-duration:31s,11s}
.g3{left:48%;top:10%;animation-duration:29s,10s}.g4{left:76%;top:22%;animation-duration:33s,12s}
.g5{left:86%;top:66%;animation-duration:28s,9.5s}.g6{left:38%;top:74%;animation-duration:35s,13s}
.g7{left:58%;top:46%;animation-duration:30s,10.5s}.g8{left:12%;top:44%;animation-duration:34s,12.5s}
.g9{left:70%;top:84%;animation-duration:32s,11.5s}
@keyframes floatY{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}
@keyframes swayX{0%,100%{transform:translateX(0)}50%{transform:translateX(6px)}}
@media(prefers-reduced-motion:reduce){.alive .shimmer,.alive .stars::before,.alive .stars::after,.alive .glyphs span{animation:none!important}}
body[data-alive="off"] .alive{display:none}

/* Ledger UI */
.action{display:flex;align-items:center;justify-content:space-between;gap:.6rem;padding:.55rem .7rem;border:1px solid var(--ring);border-radius:10px}
.action .name{display:flex;align-items:center;gap:.55rem}
.action input{transform:scale(1.25)}
.score{font-weight:700}
.grid{display:grid;gap:.75rem}
@media(min-width:900px){.grid{grid-template-columns:1fr 1fr}}
.week{display:grid;grid-template-columns:repeat(7,1fr);gap:.35rem}
.day{height:14px;border-radius:4px;background:#0f1424;border:1px solid #1a2030}
.day.on{background:linear-gradient(180deg,#1f8c50,#14623a);box-shadow:0 0 14px #1f8c5044 inset}

nav{position:sticky;top:0;z-index:3;background:linear-gradient(#0b0d11dd,#0b0d1100);backdrop-filter:saturate(120%) blur(6px);border-bottom:1px solid #1114}
nav .bar{max-width:960px;margin:auto;display:flex;gap:.5rem;align-items:center;justify-content:space-between;padding:.6rem 1rem}
.toggle{display:flex;align-items:center;gap:.4rem;color:var(--muted)}

footer{position:fixed;left:0;right:0;bottom:0;z-index:5;background:linear-gradient(180deg,#0b0d11,#07090f);border-top:1px solid #121625}
.footerbar{max-width:960px;margin:auto;display:flex;justify-content:space-between;align-items:center;gap:.5rem;padding:.6rem .9rem}
.footerbar a{border:none}
.menu{display:flex;gap:.6rem;flex-wrap:wrap}
.menu a,.menu button{background:transparent;border:1px solid #1b2234;color:#d9e3ff;border-radius:999px;padding:.45rem .7rem}
.menu button{cursor:pointer}
input[type="text"], textarea{width:100%;background:#0e1222;border:1px solid var(--ring);color:var(--ink);border-radius:8px;padding:.7rem .8rem;outline:none}

/* Print Card ‚Äî modal + page layout */
#printCard{position:fixed;inset:0;background:#0009;display:none;align-items:center;justify-content:center;z-index:9}
#printCard.open{display:flex}
.pc-wrap{background:#0e1222;border:1px solid #1b2234;border-radius:14px;box-shadow:0 20px 60px #000c;max-width:820px;width:92%;padding:1rem}
.pc-head{display:flex;align-items:center;justify-content:space-between;gap:.5rem;margin-bottom:.6rem}
.pc-head h3{margin:0;color:#e9ecf4}
.pc-body{background:#0b0f1d;border:1px solid #182036;border-radius:12px;padding:1rem}
.pc-grid{display:grid;gap:.8rem}
@media(min-width:760px){.pc-grid{grid-template-columns:1.2fr .8fr}}
.pc-field{background:#0f1426;border:1px solid #1a2030;border-radius:10px;padding:.7rem}
.pc-field .lbl{font-size:.82rem;color:#a8a9b4;margin-bottom:.35rem}
.pc-big{font-size:1.15rem;word-break:break-all}
.pc-qr{display:flex;align-items:center;justify-content:center;background:#0f1426;border:1px dashed #22304a;border-radius:10px;min-height:160px}
.pc-actions{display:flex;gap:.5rem;justify-content:flex-end;margin-top:.8rem}
@media print{
  @page{size:letter;margin:0.5in}
  body{background:#fff;color:#000}
  main, nav, footer, .alive, #printCard .pc-actions button[data-role="close"]{display:none !important}
  #printCard{display:block;position:static;background:#fff}
  .pc-wrap{border:0;box-shadow:none;padding:0;margin:0 auto}
  .pc-body{background:#fff;border:0}
  .pc-field, .pc-qr{background:#fff;border:1px solid #0002}
  .pc-head h3{color:#000}
}
</style>
</head>
<body>
<div class="alive" aria-hidden="true">
  <div class="shimmer"></div>
  <div class="stars"></div>
  <div class="glyphs"><span class="g1">‚òæ</span><span class="g2">‚ãÜ</span><span class="g3">‚úß</span><span class="g4">‚ü°</span><span class="g5">‚ãÜ</span><span class="g6">‚ú¶</span><span class="g7">‚òΩ</span><span class="g8">‚úß</span><span class="g9">‚ãÜ</span></div>
</div>

<nav>
  <div class="bar">
    <div class="toggle">
      <button id="aliveToggle" class="menu" style="background:transparent;border:1px solid #1b2234;color:#d9e3ff;border-radius:999px;padding:.35rem .6rem">Alive: <span id="aliveState">On</span></button>
    </div>
    <div class="menu">
      <a href="https://quietmoon.plnt.earth/charter-addendum.html" target="_blank" rel="noopener">Lunar Grant</a>
      <a href="https://honey.plnt.earth" target="_blank" rel="noopener">Honey</a>
      <a href="https://mirrorhoney.plnt.earth" target="_blank" rel="noopener">MirrorHoney</a>
    </div>
  </div>
</nav>

<header>
  <div class="banner"><strong>Anyone can do this.</strong> Greta is working at scale; <em>you</em> light your block. No accounts. No tracking. Start now.</div>
  <h1>üåç Earth Beacon</h1>
  <p class="kicker small">A private care ledger that turns everyday stewardship into a living Pulse ‚Äî offline-first, yours alone.</p>
  <div style="text-align:center">
    <a href="#pulse" class="cta">Start Today</a>
    <a href="#why" class="cta ghost" style="margin-left:.5rem">Why it matters</a>
    <a id="openPrintCard" href="#" class="cta ghost" style="margin-left:.5rem">Print Card</a>
  </div>
</header>

<main>
  <section id="pulse" class="card">
    <h2>Today‚Äôs Pulse <span id="score" class="score">0</span>/100</h2>
    <div class="row small">
      <span id="streak">Streak: 0 days</span>
      <span>¬∑</span>
      <span id="dateLabel"></span>
    </div>

    <div class="grid" style="margin-top:.6rem">
      <div class="action"><div class="name"><input type="checkbox" data-key="walk"><span>Walk/Transit instead of car</span></div><span class="small">+14</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="plant"><span>Plant/Soil care (water, tend, compost)</span></div><span class="small">+12</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="repair"><span>Repair/Reuse instead of buy new</span></div><span class="small">+16</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="veg"><span>Veg meal (lower-impact choice)</span></div><span class="small">+10</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="refill"><span>Refilled bottle (no single-use)</span></div><span class="small">+6</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="quiet"><span>Quiet minute outdoors (listen & notice)</span></div><span class="small">+8</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="help"><span>Helped someone (care as culture)</span></div><span class="small">+12</span></div>
      <div class="action"><div class="name"><input type="checkbox" data-key="civic"><span>Civic note: wrote/called/read policy</span></div><span class="small">+18</span></div>
    </div>
    <p class="small">Weights favor reuse/repair and civic action, while honoring daily rhythms like walking and quiet attention.</p>
  </section>

  <section class="card">
    <h2>This Week</h2>
    <div id="week" class="week" aria-label="7-day strip"></div>
    <p class="small">Green squares show days you hit a Pulse ‚â• 30. Keep it kind; consistency beats intensity.</p>
  </section>

  <section class="card">
    <h2>Echo & Share</h2>
    <p class="small">Everything stays on your device. If you want to inspire someone, generate a tiny code or link that encodes only your last 7 days‚Äô totals (no identity).</p>
    <div class="row">
      <a id="makeCode" class="cta" href="#">Make Echo Code</a>
      <input id="codeOut" type="text" readonly placeholder="‚Äî‚Äî‚Äî" style="flex:1">
      <a id="copyCode" class="cta ghost" href="#">Copy</a>
    </div>
    <div class="row" style="margin-top:.4rem">
      <a id="makeLink" class="cta" href="#">Make Share-Link</a>
      <input id="linkOut" type="text" readonly placeholder="‚Äî‚Äî‚Äî" style="flex:1">
      <a id="copyLink" class="cta ghost" href="#">Copy</a>
    </div>
    <div class="row" style="margin-top:.6rem">
      <input id="enterCode" type="text" placeholder="Enter Echo Code to light the field">
      <a id="light" class="cta ghost" href="#">Light</a>
    </div>
    <p class="small" id="echoStatus">No echoes yet.</p>
  </section>

  <section class="card">
    <h2>Notes (private)</h2>
    <textarea id="note" placeholder="What did care look like today? What did you notice?"></textarea>
    <div class="row" style="margin-top:.4rem">
      <a id="saveNote" class="cta" href="#">Save</a>
      <span id="saveStatus" class="small">Not saved</span>
    </div>
  </section>

  <section id="why" class="card">
    <h2>Why this matters</h2>
    <p class="small"><strong>Greta works at scale.</strong> You work at touch-distance. Policy and industry must change ‚Äî and culture is how it changes. This ledger is not guilt; it‚Äôs <em>proof of rhythm</em>. Small, repeated acts tune neighborhoods. Your Pulse is a mirror: it shows care that‚Äôs already happening and makes it contagious.</p>
    <p class="small">Start now. Share when helpful. It‚Äôs already enough to begin.</p>
  </section>
</main>

<footer>
  <div class="footerbar">
    <div class="menu">
      <a href="https://earth.plnt.earth" aria-label="Refresh page">Earth</a>
      <a href="https://quietmoon.plnt.earth/charter.html" target="_blank" rel="noopener">Moon Charter</a>
      <a href="https://quietmoon.plnt.earth/charter-addendum.html" target="_blank" rel="noopener">Lunar Grant</a>
    </div>
    <div class="menu">
      <button id="resetDay">Reset Today</button>
      <button id="aliveToggle2">Alive: <span id="aliveState2">On</span></button>
    </div>
  </div>
</footer>

<!-- Print Card Modal -->
<div id="printCard" role="dialog" aria-modal="true" aria-label="Earth Beacon Print Card">
  <div class="pc-wrap">
    <div class="pc-head">
      <h3>üåç Earth Beacon ‚Äî Print Card</h3>
      <div class="pc-actions">
        <button data-role="close" class="ghost" style="padding:.45rem .7rem;border-radius:8px">Close</button>
        <button data-role="print" class="cta" style="padding:.45rem .7rem;border-radius:8px">Print</button>
      </div>
    </div>
    <div class="pc-body">
      <div class="pc-grid">
        <div class="pc-field">
          <div class="lbl">Share-Link (anyone can use)</div>
          <div id="pcLink" class="pc-big">earth.plnt.earth</div>
        </div>
        <div class="pc-qr">
          <!-- Optional QR placeholder; printing includes the link & code even without QR -->
          <div class="small" id="pcQrHint" style="text-align:center;padding:.6rem">
            (Optional) The printed card shows the link & code clearly.<br/>If you need a QR later, open this page and press Print Card again.
          </div>
        </div>
      </div>

      <div class="pc-grid" style="margin-top:.8rem">
        <div class="pc-field">
          <div class="lbl">Echo Code (last 7 days, no identity)</div>
          <div id="pcCode" class="pc-big">‚Äî‚Äî‚Äî</div>
        </div>
        <div class="pc-field">
          <div class="lbl">Today‚Äôs Pulse</div>
          <div id="pcPulse" class="pc-big">0 / 100</div>
        </div>
      </div>

      <div class="pc-field" style="margin-top:.8rem">
        <div class="lbl">Start Now ‚Äî One-Tap Actions</div>
        <div class="small">‚òê Walk/Transit ¬∑ ‚òê Plant/Soil ¬∑ ‚òê Repair/Reuse ¬∑ ‚òê Veg Meal ¬∑ ‚òê Refill Bottle ¬∑ ‚òê Quiet Minute ¬∑ ‚òê Help Someone ¬∑ ‚òê Civic Note</div>
      </div>

      <div class="small" style="margin-top:.6rem;color:#a8a9b4">
        Anyone can do this while Greta leads at scale. No accounts. No tracking. Your rhythm lights your block.
      </div>
    </div>
  </div>
</div>

<script>
(function(){
  /* Alive toggles */
  var a1=document.getElementById('aliveToggle'), a2=document.getElementById('aliveToggle2');
  var s1=document.getElementById('aliveState'), s2=document.getElementById('aliveState2');
  function setAlive(on){
    document.documentElement.setAttribute('data-alive', on?'on':'off');
    if(s1) s1.textContent=on?'On':'Off';
    if(s2) s2.textContent=on?'On':'Off';
  }
  function bindAlive(btn){ if(btn){ btn.addEventListener('click',function(e){ e.preventDefault(); var on=document.documentElement.getAttribute('data-alive')!=='off'; setAlive(!on); }); } }
  bindAlive(a1); bindAlive(a2);

  /* Dates */
  function ymd(d){ return d.getFullYear()+"-"+String(d.getMonth()+1).padStart(2,"0")+"-"+String(d.getDate()).padStart(2,"0"); }
  var today=new Date(); var todayKey=ymd(today);
  var dateLabel=document.getElementById('dateLabel'); if(dateLabel){ dateLabel.textContent=today.toDateString(); }

  /* Storage helpers */
  function load(){ try{ return JSON.parse(localStorage.getItem('earth_ledger')||'{}'); }catch(e){ return {}; } }
  function save(obj){ try{ localStorage.setItem('earth_ledger', JSON.stringify(obj)); }catch(e){} }
  var store=load(); if(!store.days) store.days={}; if(!store.notes) store.notes={}; if(!store.echoes) store.echoes=[];

  /* Weights */
  var WEIGHTS={walk:14,plant:12,repair:16,veg:10,refill:6,quiet:8,help:12,civic:18};

  /* Elements */
  var checks=[].slice.call(document.querySelectorAll('.action input[type="checkbox"]'));
  var scoreEl=document.getElementById('score'), streakEl=document.getElementById('streak');
  var weekEl=document.getElementById('week');
  var note=document.getElementById('note'), saveNote=document.getElementById('saveNote'), saveStatus=document.getElementById('saveStatus');

  /* Day I/O */
  function readDay(key){ return store.days[key]||{walk:0,plant:0,repair:0,veg:0,refill:0,quiet:0,help:0,civic:0}; }
  function writeDay(key,val){ store.days[key]=val; save(store); }

  function scoreDay(d){
    var s=0; for(var k in WEIGHTS){ if(d[k]) s+=WEIGHTS[k]; }
    return Math.min(100,s);
  }

  function calcStreak(){
    var count=0;
    for(var i=0;i<365;i++){
      var dt=new Date(); dt.setDate(today.getDate()-i);
      var k=ymd(dt); var d=readDay(k); var sc=scoreDay(d);
      if(sc>=30){ count++; } else { break; }
    }
    return count;
  }

  function renderWeek(){
    if(!weekEl) return;
    weekEl.innerHTML="";
    for(var i=6;i>=0;i--){
      var dt=new Date(); dt.setDate(today.getDate()-i);
      var k=ymd(dt); var d=readDay(k); var sc=scoreDay(d); var ok=(sc>=30);
      var cell=document.createElement('div');
      cell.className='day'+(ok?' on':''); cell.title=k+' ¬∑ '+sc;
      weekEl.appendChild(cell);
    }
  }

  function render(){
    var d=readDay(todayKey);
    checks.forEach(function(c){ c.checked=!!d[c.dataset.key]; });
    var base=scoreDay(d);
    var streak=calcStreak();
    var bonus=Math.min(10,streak); /* +1/day, max +10 */
    var total=Math.min(100, base+bonus);
    if(scoreEl) scoreEl.textContent=total;
    if(streakEl) streakEl.textContent="Streak: "+streak+" day"+(streak===1?"":"s");
    renderWeek();
  }

  checks.forEach(function(c){
    c.addEventListener('change', function(){
      var d=readDay(todayKey); d[this.dataset.key]=this.checked?1:0; writeDay(todayKey,d); render();
    });
  });

  /* Notes */
  try{ if(store.notes[todayKey]) note.value=store.notes[todayKey]; }catch(e){}
  if(saveNote){ saveNote.addEventListener('click', function(e){ e.preventDefault(); store.notes[todayKey]=note.value||""; save(store); if(saveStatus){ saveStatus.textContent='Saved'; } }); }

  /* Reset Today */
  var reset=document.getElementById('resetDay');
  if(reset){ reset.addEventListener('click', function(){ store.days[todayKey]={}; save(store); render(); }); }

  /* Echo & Share (last 7 totals only) */
  function last7(){
    var arr=[];
    for(var i=6;i>=0;i--){
      var dt=new Date(); dt.setDate(today.getDate()-i);
      var k=ymd(dt); arr.push(scoreDay(readDay(k)));
    }
    return arr;
  }
  function toB36(n){ return n.toString(36).toUpperCase().padStart(2,'0'); }
  function fromB36(s){ return parseInt(s,36); }
  function makeEcho(){
    var arr=last7();
    var code=arr.map(function(n){ return toB36(Math.min(35, Math.round(n/3))); }).join('');
    return code; /* 14 chars */
  }
  function decodeEcho(code){
    if(!code || code.length%2!==0) return [];
    var vals=[];
    for(var i=0;i<code.length;i+=2){
      var v=fromB36(code.slice(i,i+2)); vals.push(Math.min(100, Math.round(v*3)));
    }
    return vals;
  }

  var makeCode=document.getElementById('makeCode'), codeOut=document.getElementById('codeOut'), copyCode=document.getElementById('copyCode');
  var makeLink=document.getElementById('makeLink'), linkOut=document.getElementById('linkOut'), copyLink=document.getElementById('copyLink');
  var enterCode=document.getElementById('enterCode'), light=document.getElementById('light'), echoStatus=document.getElementById('echoStatus');

  if(makeCode){ makeCode.addEventListener('click', function(e){ e.preventDefault(); var code=makeEcho(); if(codeOut){ codeOut.value=code; } if(echoStatus){ echoStatus.textContent='Echo ready'; } }); }
  if(copyCode){ copyCode.addEventListener('click', function(e){ e.preventDefault(); if(codeOut&&codeOut.value){ navigator.clipboard.writeText(codeOut.value); if(echoStatus){ echoStatus.textContent='Copied code'; } } }); }
  if(makeLink){ makeLink.addEventListener('click', function(e){
    e.preventDefault();
    var code=makeEcho();
    var url=location.origin+location.pathname+'#echo='+code;
    if(linkOut) linkOut.value=url;
    if(echoStatus) echoStatus.textContent='Link ready';
    history.replaceState(null,'',url);
  });}
  if(copyLink){ copyLink.addEventListener('click', function(e){ e.preventDefault(); if(linkOut&&linkOut.value){ navigator.clipboard.writeText(linkOut.value); if(echoStatus){ echoStatus.textContent='Copied link'; } } }); }

  if(location.hash.startsWith('#echo=')){
    var raw=location.hash.slice(6); var vals=decodeEcho(raw);
    if(vals.length){ if(echoStatus) echoStatus.textContent='Echo loaded: '+vals.join(', '); }
  }

  if(light){ light.addEventListener('click', function(e){
    e.preventDefault();
    var vals=decodeEcho(enterCode.value.trim());
    if(vals.length){ store.echoes.push({at:Date.now(), vals:vals}); save(store); echoStatus.textContent='Echo received ‚Äî the field is brighter.'; }
    else { echoStatus.textContent='Invalid code.'; }
  }); }

  /* -------- Print Card logic -------- */
  var modal=document.getElementById('printCard');
  var openBtn=document.getElementById('openPrintCard');
  var closeBtn=modal.querySelector('[data-role="close"]');
  var printBtn=modal.querySelector('[data-role="print"]');
  var pcLink=document.getElementById('pcLink');
  var pcCode=document.getElementById('pcCode');
  var pcPulse=document.getElementById('pcPulse');

  function openCard(e){
    if(e) e.preventDefault();
    // Fill fields
    var code=makeEcho();
    var url=location.origin+location.pathname+'#echo='+code;
    if(pcLink) pcLink.textContent=url.replace(/^https?:\/\//,''); // shorter for print
    if(pcCode) pcCode.textContent=code || '‚Äî‚Äî‚Äî';
    var d=readDay(todayKey); var total=Math.min(100, scoreDay(d)+Math.min(10, calcStreak()));
    if(pcPulse) pcPulse.textContent=total+' / 100';
    modal.classList.add('open');
  }
  function closeCard(e){ if(e) e.preventDefault(); modal.classList.remove('open'); }
  function doPrint(e){ if(e) e.preventDefault(); window.print(); }

  if(openBtn) openBtn.addEventListener('click', openCard);
  if(closeBtn) closeBtn.addEventListener('click', closeCard);
  if(printBtn) printBtn.addEventListener('click', doPrint);

  /* Init view */
  render();
})();
</script>
</body>
</html>
